<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Créer un compte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
<main>
  <h2>Créer un compte</h2>

  <!-- Le formulaire d'inscription -->
  <form th:action="@{/auth/register}" th:object="${user}" method="post" novalidate>

    <!-- Redirection éventuelle après l'inscription -->
    <input type="hidden" name="redirect"
           th:value="${redirect != null && !#strings.isEmpty(redirect) ? redirect : (param.redirect != null ? param.redirect : null)}"/>

    <div>
      <label for="username">Nom d'utilisateur :</label>
      <input type="text" id="username" th:field="*{username}" required autofocus autocomplete="username"/>
      <div th:if="${#fields.hasErrors('username')}" th:errors="*{username}" style="color:red"></div>
    </div>

    <div>
      <label for="password">Mot de passe :</label>
      <input type="password" id="password" th:field="*{password}" required autocomplete="new-password"/>
      <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}" style="color:red"></div>
    </div>

    <div>
      <label for="role">Rôle :</label>
      <select id="role" th:field="*{role}" required>
        <!-- ⚙️ Option par défaut -->
        <option value="" disabled
                th:selected="${user.role == null or user.role == ''}">— Sélectionnez un rôle —</option>
        <!-- Liste des rôles -->
        <option th:each="r : ${roles}" th:value="${r}" th:text="${r}"></option>
      </select>
      <div th:if="${#fields.hasErrors('role')}" th:errors="*{role}" style="color:red"></div>
    </div>

    <!-- Si tu utilises CSRF, décommente :
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    -->

    <div>
      <button type="submit">S'inscrire</button>
    </div>
  </form>

  <div th:if="${param.error}">
    <p style="color:red" th:text="${param.error}">Une erreur est survenue</p>
  </div>

  <p>
    Déjà un compte ?
    <a th:href="@{/auth/login(redirect=${redirect != null ? redirect : param.redirect})}">Se connecter</a>
  </p>
</main>
</body>
</html>
